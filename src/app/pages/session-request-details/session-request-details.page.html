<app-page-header [config]="headerConfig"></app-page-header>

<ion-content class="ion-padding">
  <div class="profile-container">
    <ion-avatar class="profile-avatar">
      <img src="assets/prof-img/user.png" alt="Profile Picture" />
    </ion-avatar>

    <h2 class="profile-name">{{apiDemoResponse.name}}</h2>
    <p class="profile-description">
      <ng-container *ngFor="let item of apiDemoResponse?.designation.slice(0,2); let i = index">
        {{ item.label }}<span *ngIf="i < 1">, </span>
      </ng-container>
    </p>

    <ion-button color="primary" (click)="viewProfile(apiDemoResponse?.id)">View Profile</ion-button>
    <ion-text class="description">
      <h2 class="text-left">Agenda</h2>
      <p style="margin: 0px;" class="text-left">
        {{ showFullText ? apiDemoResponse.agenda : apiDemoResponse.agenda | slice:0:200 }}{{ apiDemoResponse.agenda.length > 200 && !showFullText ? '...' : '' }}
      </p>
    </ion-text>
    
    <ion-label 
      *ngIf="apiDemoResponse.agenda.length > 200" 
      class="viewMore" 
      (click)="toggleText()">
      {{ showFullText ? 'View Less' : 'View More' }}
    </ion-label>    

    <p class="request-info text-left">
      You have requested a slot at <strong>2:00 pm - 3:00 pm</strong> on <strong>Monday (01 May 2023)</strong>
    </p>
    <ng-container>
      <div class="text-left" *ngIf="isAccepted">
        <h2 class="auto-margin">Meeting link</h2>
          @if (this.existingData?.meeting_info?.meta?.meetingId) {
            <div>
              <ion-label>Meeting will take place on <b>Zoom</b></ion-label><br>
              <ion-label>Meeting ID : 12345</ion-label><br>
              <ion-label>Passcode : 1234</ion-label>
            </div>
          } @else if (this.existingData?.meeting_info?.link) {
            <div>
              <ion-label>
                Google meet : link
              </ion-label>
            </div>
          } @else {
            <div>
              <ion-label>BBB</ion-label>
            </div>
          }
        <ion-button color="primary" *ngIf="!isMeetingLinkAdded" (click)="addLink(true)"> Add link </ion-button>
        <ion-button color="primary" *ngIf="isMeetingLinkAdded" (click)="editLink(true)"> Edit link </ion-button>
      </div>

      <ion-chip color="warning" style="color: var(--black); background-color: #fdf6b4; margin-bottom: 2%;">
        <ion-icon name="alert-circle"></ion-icon>
        @if (isRejected) {
          <ion-label class="text-left">You have rejected the slot request</ion-label>
        } @else if (isAccepted) {
          <ion-label class="text-left">Start button will get enabled 10 min before schedule time</ion-label>
        } @else {
          <ion-label class="text-left">Please wait for John Doe to respond to your request</ion-label>
        }
      </ion-chip>
      
      <ion-modal #modal [isOpen]="isModalOpen" [backdropDismiss]="false">
        <ng-template>
          <ion-content>
            <ion-list>
              <ion-card  class="form-content">
                <ion-card-header>
                  <ion-card-title class="ion-text-center card-title">{{"SELECT_MEETING_PLATFORM" | translate}}</ion-card-title>
                </ion-card-header>
                <ion-card-content>
                  <ion-list>
                    <ion-select #link class="select" [(ngModel)]="selectedLink" interface="popover" (ionChange)="clickOptions($event)" [compareWith]="compareWithFn" [value]="selectedLink">
                      <ion-select-option [value]="option" *ngFor="let option of meetingPlatforms">
                        {{ option.name }}
                      </ion-select-option>
                    </ion-select>
                    <ion-item lines="none">
                      <ion-icon class="hint-icon" name="alert-circle"></ion-icon>
                      <ion-label class="hint-label">{{selectedHint}}</ion-label>
                    </ion-item>
                  </ion-list>
                  <div *ngFor="let option of meetingPlatforms">
                    <app-dynamic-form *ngIf="selectedLink==option" [jsonFormData]="option?.form" #platformForm></app-dynamic-form>
                </div>
                </ion-card-content>
              </ion-card>
            </ion-list>
          </ion-content>
          <ion-footer>
            <ion-toolbar>
              <div class="w-full flex flex-justify-flex-end">
                <ion-button color="primary"[disabled]="platformForm && !platformForm.myForm.valid" (click)="addNow()">Add now</ion-button>
                <ion-button color="primary" (click)="addLater()">Add later</ion-button>
              </div>
            </ion-toolbar>
          </ion-footer>
        </ng-template>
      </ion-modal>
      <mat-accordion>
        <mat-expansion-panel style="background: #f3f3f3;;">
          <mat-expansion-panel-header>
            <mat-panel-title>
              <ion-icon size="large" name="calendar-outline"></ion-icon>
            </mat-panel-title>
            <mat-panel-description style="font-size: large;">
              Your schedule
            </mat-panel-description>
          </mat-expansion-panel-header>
          <div class="timeline">
            <div class="timeline-item" *ngFor="let event of yourScheduledData">
              <div class="timeline-dot"></div>
              <div class="timeline-date">
                {{event.date}}
              </div>
              <div class="timeline-card" *ngFor="let event of event.bookedSlots">
                <ion-grid>
                  <ion-row class="ion-align-items-center">
                    <ion-col size-lg="3">
                      <p class="margin-none text-left px-4">{{ event?.startTime }}</p> <br />
                      <p class="margin-none text-left px-4">{{ event?.endTime }}</p>
                    </ion-col>
                    <ion-col size-lg="3"> <h3 class="margin-none">{{event?.title}}</h3> </ion-col>
                  </ion-row>
                </ion-grid>
              </div>
              <div class="timeline-line"></div>
            </div>
          </div>
          
        </mat-expansion-panel>
      </mat-accordion>
    </ng-container>
  </div>
</ion-content>
<ion-footer class="ion-no-border footer-button" *ngIf="!isRejected">
  <ion-toolbar>
    <ng-container *ngIf="!isAccepted; else templateA">
      <div class="w-full flex flex-justify-space-around">
        <ion-button shape="round" color="light" (click)="accept()" class="height-0">
          <ion-icon style="color: var(--green);" name="checkmark-outline" slot="start"></ion-icon> Accept
        </ion-button>
        <ion-button shape="round" color="light" (click)="reject()" class="height-0">
          <ion-icon style="color:  var(--red);" name="checkmark-outline" slot="start"></ion-icon> Reject
        </ion-button>
      </div>
    </ng-container> 
    <ng-template #templateA>
      <ion-button expand="full" [disabled]="true">Start</ion-button>
    </ng-template>
  </ion-toolbar>
</ion-footer>


